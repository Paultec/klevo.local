<?php
    //$data = $this->product->getVariables();
?>
<style>
    label {
        max-width: 250px;
        float: left;
    }

    input[type="number"], input[type="submit"] {
        max-width: 100px;
    }

    .add {
        width: 22px;
        font-size: 22px;
        cursor: pointer;
        margin: 0;
    }

    .add i {
        vertical-align: middle;
    }
</style>

<!--Блок с информацией о записи в таблице Register-->
<div><p><strong>Данные о записи:</strong></p>
    <table class="table table-striped">
        <tr>
            <th>Дата:</th>
            <th>От кого:</th>
            <th>Кому:</th>
            <th>Тип операции:</th>
            <th>Форма оплаты:</th>
            <th>Статус:</th>
            <th>Кто оформил:</th>
        </tr>
        <tr>
        <?php
        $register = $this->register->getArrayCopy();

        echo '<td>' . $register['date']->format('d.m.Y') .'</td>',
             '<td>' . $register['idStoreFrom']->getName() .'</td>',
             '<td>' . $register['idStoreTo']->getName() .'</td>',
             '<td>' . $register['idOperation']->getName() .'</td>',
             '<td>' . $register['idPaymentType']->getName() .'</td>',
             '<td>' . $register['idStatus']->getName() .'</td>',
             '<td>' . $register['idUser']->getEmail() .'</td>';
        ?>
        </tr>
    </table>
</div>
<!--Конец блока с информацией о записи в таблице Register-->

<!--Блок с информацией о записи товаров в таблице RegisterTable-->
<div><p><strong>Товары:</strong></p>
    <?php if ($this->productList) : ?>

    <table id="productList-table" class="table table-striped table-hover">
        <thead>
        <tr>
            <th>Производитель</th>
            <th>Категория</th>
            <th>Название</th>
            <th>К-во</th>
            <th>Цена</th>
            <th>Сумма</th>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($this->productList as $item): ?>
        <tr>
            <td><?php echo $item->brand; ?></td>
            <td><?php echo $item->category; ?></td>
            <td><?php echo $item->getName(); ?></td>
            <td><?php echo $item->currentQty; ?></td>
            <td><?php echo $item->currentPrice; ?></td>
            <td><?php echo $item->currentPrice * $item->currentQty; ?></td>
        </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
</div>
<!--Конец блока с информацией о записи товаров в таблице RegisterTable-->
<form method="post" action="add">Нажмите
    <input type="submit" class="btn btn-warning" value="Готово"> если закончили ввод товаров
</form>
<?php endif; ?>

<div>
    <form method="post" action="<?php echo $this->url('register-table');?>" class="float-form" role="form">
        <?php
            echo '<label>Производитель:' . "\n";
            echo '<select class="form-control" name="idBrand">' . "\n";
            echo $this->partialLoop('register/partial/optionLoop.phtml', $this->catalogList['brand']);
            echo '</select>' . "\n";
            echo '</label>' . "\n";

            echo '<label>Категория:' . "\n";
            echo '<select class="form-control" name="idCatalog">' . "\n";
            echo $this->partialLoop('register/partial/optionLoop.phtml', $this->catalogList['category']);
            echo '</select>' . "\n";
            echo '</label>' . "\n";
        //var_dump($this->catalogList['category']);
        ?>
        <input type="submit" class="btn btn-info" name="addFilter" value="Выбрать">
    </form>
</div>

<!--<section class="col col-lg-3">-->
<!--    <aside class="filter">-->
<!--        <h3><span class="glyphicon glyphicon-filter"></span> Каталог товаров</h3>-->
<!--        <span class="link-type" data-type="--><?php //echo $this->type;?><!--"></span>-->
<!--        <!-- Accordion -->
<!--        --><?php //echo $this->catalog ;?><!--<!-- /Accordion -->
<!--    </aside>-->
<!--</section>-->

<section class="col col-lg-12">
<!--    --><?php //if (count($data['breadcrumbs']) > 0) : ?>
<!--        <ol class="breadcrumb">-->
<!--            --><?php
//            foreach ($data['breadcrumbs'] as $key => $value) {
//                if (is_object($value)) {
//                    echo '<li><a href="?' . $key . '=' . $value->getId() . '">' . $value->getName() . '</a></li>';
//                }
//            }
//            ?>
<!--        </ol>-->
<!--    --><?php //endif ?>

    <?php if ($this->product): ?>

        <table id="product-table" class="table table-striped ">
            <thead>
            <tr>
                <th>Название</th>
                <th>К-во / Цена / Действие</th>
            </tr>
            </thead>

            <tfoot>
            <tr>
                <th>Название</th>
                <th>К-во / Цена / Действие</th>
            </tr>
            </tfoot>
            <tbody>
            <?php foreach($this->product as $item): ?>
                <tr>
                    <td style="max-width: 450px"><?php echo $item->getName(); ?></td>
                    <td>
                        <form method="post" action="<?php echo $this->url('register-table');?>" class="form-inline product-select" role="form">
                            <input type="hidden" name="idProduct" value="<?php echo $item->getId(); ?>">

                            <div class="form-group">
                                <label class="sr-only" for="qty">К-во:</label>
                                <input type="number" min="1" step="1" class="form-control qty" name="qty" value="<?php echo $item->getQty(); ?>">
                            </div>

                            <div class="form-group">
                                <label class="sr-only" for="price">Цена:</label>
                                <input type="number" min="0.01" step="0.01" class="form-control price" name="price" value="<?php echo $item->getPrice() / 100; ?>">
                            </div>

                            <div class="form-group">
                                <label class="add">
                                    <input class="btn btn-default hide add-button" type="submit" value="Добавить">
                                    <i class="glyphicon glyphicon-circle-arrow-up" data-toggle="tooltip" data-placement="top" title="Добавить"></i>
                                </label>
                            </div>
                        </form>
                    </td>
                </tr>
            <?php endforeach; ?>
            </tbody>
        </table>
    <?php else: ?>
        <h2>Выберите производителя или категорию для продолжения.</h2>
    <?php endif ?>
</section>
<script>
    // Выделить содержимое по клику
    $('.price').on('click', function() {
        $(this).select();
    });

    $('.add-button').on('click', function(e) {
        var qty     = $(this).parent().parent().siblings().find('.qty');
        var price   = $(this).parent().parent().siblings().find('.price');

        if (qty.val() == '') {
            qty.css('border', '1px solid red');

            e.preventDefault();
        }

        if (price.val() < 0) {
            price.css('border', '1px solid red');

            e.preventDefault();
        }
    });
</script>