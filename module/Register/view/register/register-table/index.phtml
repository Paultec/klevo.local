<?php
    $data = $this->product->getVariables();
?>
<link rel="stylesheet" href="/css/jquery.dataTables.css">
<link rel="stylesheet" href="/css/shCore.css">

<!--Блок с информацией о записи в таблице Register-->
<div>Данные о записи:
    <?php
    $register = $this->register->getArrayCopy();
    $date = new \DateTime($register['date']->getTimestamp);
//    var_dump($date);
//    var_dump($register);
//    echo 'Дата: ' . $date->date;
    echo 'От кого: ' . $register['idStoreFrom']->getName();
    echo 'Кому: ' . $register['idStoreTo']->getName();
    echo 'Тип операции: ' . $register['idOperation']->getName();
    echo 'Форма оплаты: ' . $register['idPaymentType']->getName();
    echo 'Статус: ' . $register['idStatus']->getName();
    echo 'Кто оформил: ' . $register['idUser']->getEmail();
    ?>
</div>
<!--Конец блока с информацией о записи в таблице Register-->

<!--Блок с информацией о записи товаров в таблице RegisterTable-->
<div>Товары:
    <?php
    $productList = $this->productList;
    if ($productList): ;
    ?>
    <table id="productList-table" class="table">
        <thead>
        <tr>
            <th>Производитель</th>
            <th>Категория</th>
            <th>Название</th>
            <th>К-во</th>
            <th>Цена</th>
            <th>Сумма</th>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($productList as $item): ?>
        <tr>
            <td><?php echo $item->brand; ?></td>
            <td><?php echo $item->category; ?></td>
            <td><?php echo $item->getName(); ?></td>
            <td><?php echo $item->currentQty; ?></td>
            <td><?php echo $item->currentPrice; ?></td>
            <td><?php echo $item->currentPrice * $item->currentQty; ?></td>
        </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
</div>
<!--Конец блока с информацией о записи товаров в таблице RegisterTable-->
<form method="post" action="add">Нажмите
    <input type="submit" value="Готово"> если закончили ввод товаров
</form>
<?php endif; ?>

<section class="col col-lg-3">
    <aside class="filter">
        <h3><span class="glyphicon glyphicon-filter"></span> Каталог товаров</h3>
        <span class="link-type" data-type="<?php echo $this->type;?>"></span>
        <!-- Accordion -->
        <?php echo $this->catalog ;?><!-- /Accordion -->
    </aside>
</section>

<section class="col col-lg-9">
    <?php if (count($data['breadcrumbs']) > 0) : ?>
        <ol class="breadcrumb">
            <?php
            foreach ($data['breadcrumbs'] as $key => $value) {
                if (is_object($value)) {
                    echo '<li><a href="?' . $key . '=' . $value->getId() . '">' . $value->getName() . '</a></li>';
                }
            }
            ?>
        </ol>
    <?php endif ?>

    <?php if ($data['result']): ?>
        <table id="product-table" class="table table-striped">
            <thead>
            <tr>
                <th>Название</th>
                <th>к-во</th>
                <th>Цена</th>
                <th>Действие</th>
            </tr>
            </thead>

            <tfoot>
            <tr>
                <th>Название</th>
                <th>К-во</th>
                <th>Цена</th>
                <th>Действие</th>
            </tr>
            </tfoot>
            <tbody>
            <?php foreach($data['result'] as $item): ?>
                <tr>
                    <form method="post" action="index">
                    <td><?php echo $item->getName(); ?></td>
                    <td><input type="text" name="qty" value="<?php echo $item->qty; ?>"></td>
                    <td><input type="text" name="price" value="<?php echo $item->getPrice() / 100; ?>"></td>
                    <td><input type="hidden" name="idProduct" value="<?php echo $item->getId(); ?>"><input type="submit" value="Добавить"></td>
                    </form>
                </tr>
            <?php endforeach; ?>
            </tbody>
        </table>

    <?php else: ?>
        <h2>Выберите производителя или категорию для продолжения.</h2>
    <?php endif ?>
</section>

<script src="/js/jquery.dataTables.js"></script>
<script src="/js/shCore.js"></script>
<script>
    $('#product-table').dataTable({
        "language": {
            "url": "/resources/ru_RU.lg"
        }
    });
</script>